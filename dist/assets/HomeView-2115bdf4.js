import{d as w,t as y,r as d,w as C,c as b,o as T,a as m,b as f,e as n,u as h,f as u,g as x,n as N,h as B,i as L,F as G,j as R,k as F}from"./index-4d3b5187.js";const M={class:"ticker-card"},A={class:"ticker-card__col"},O={class:"ticker-card__row"},H={key:0,class:"ticker-card__logo"},K={class:"ticker-card__ticker"},V={class:"ticker-card__row"},W={class:"ticker-card__name"},$={class:"ticker-card__col ticker-card__col_items-right"},j={class:"ticker-card__row"},q={key:0},D={class:"ticker-card__row"},J=w({__name:"TickerCard",props:{logo:{},ticker:{},price:{},companyName:{},changePriceInPoints:{},changePriceInPercents:{}},setup(P){const r=P,{logo:o,ticker:c,price:p,companyName:v,changePriceInPoints:l,changePriceInPercents:a}=y(r),t=d({badge:"",text:""}),e=d([]);C(()=>r.price,(s,g)=>{i(s>g),S(s,g)});const _=s=>(isNaN(s)&&(s=0),(Math.round(s*100)/100).toFixed(2)),S=(s,g)=>{let U=_(s),I=null;for(let k=0;k<U.length;k++)if(U[k]!==g.toString()[k]){I=k;break}e.value=[U.slice(0,I),U.slice(I)]},i=s=>{t.value={badge:s?"ticker-card__ltp_green":"ticker-card__ltp_red",text:""},setTimeout(()=>{t.value={badge:"",text:s?"text-green":"text-red"}},2e3)},E=b(()=>l.value===0?"":l.value>0?"text-green":"text-red");return T(()=>{e.value[1]=_(p.value)}),(s,g)=>(m(),f("div",M,[n("div",A,[n("div",O,[h(o)?(m(),f("div",H,u(h(o)),1)):x("",!0),n("div",K,u(h(c)),1)]),n("div",V,[n("div",W,u(h(v)),1)])]),n("div",$,[n("div",j,[n("div",{class:N(["ticker-card__ltp",t.value.badge])},[e.value[0]?(m(),f("span",q,u(e.value[0]),1)):x("",!0),n("span",{class:N(t.value.text)},u(e.value[1]),3)],2)]),n("div",D,[n("div",{class:N(["ticker-card__changes",E.value])},u(_(h(l))),3),n("div",{class:N(["ticker-card__changes",E.value])},u(_(h(a)))+"% ",3)])])]))}});function X(P,r){const o="WebSocket"in window;let c=null;const p=d(null),v=d(null),l=d(null),a=d(!1),t=d(!1),e=d(!1);let _=()=>{},S=()=>{};return o&&(c=new WebSocket(P,r),c.addEventListener("message",i=>{p.value=i,l.value=i.data}),c.addEventListener("error",i=>{v.value=i,e.value=!0}),c.addEventListener("close",()=>{a.value=!1,t.value=!0}),c.addEventListener("open",()=>{a.value=!0,t.value=!1}),_=i=>c.send(i),S=(i,E)=>{c.close(i,E)}),{supported:o,ws:c,send:_,close:S,messageEvent:p,errorEvent:v,data:l,isOpen:a,isClosed:t,errored:e}}const Y=w({__name:"TickerCardList",setup(P){const r=B({}),o=b(()=>Object.values(r)),c=["RSTI","GAZP","MRKZ","RUAL","HYDR","MRKS","SBER","FEES","TGKA","VTBR","ANH.US","VICL.US","BURG.US","NBL.US","YETI.US","WSFS.US","NIO.US","DXC.US","MIC.US","HSBC.US","EXPN.EU","GSK.EU","SHP.EU","MAN.EU","DB1.EU","MUV2.EU","TATE.EU","KGF.EU","MGGT.EU","SGGD.EU"],{isOpen:p,send:v,messageEvent:l}=X("wss://wss.tradernet.ru");return C(()=>p.value,a=>{a&&v(JSON.stringify(["quotes",c]))}),C(()=>l.value,a=>{const t=JSON.parse(a.data);if(t[0]!=="q")return;const e=t[1];e!=null&&e.name?r[e.c]={ticker:e.c,price:e.ltp,companyName:e.name,changePriceInPoints:e.chg,changePriceInPercents:e.pcp}:e!=null&&e.chg&&(r[e.c].price=e.ltp,r[e.c].changePriceInPoints=e.chg,r[e.c].changePriceInPercents=e.pcp)}),(a,t)=>(m(!0),f(G,null,L(o.value,e=>(m(),R(J,{key:e.ticker,ticker:e.ticker,price:e.price,companyName:e.companyName,changePriceInPoints:e.changePriceInPoints,changePriceInPercents:e.changePriceInPercents},null,8,["ticker","price","companyName","changePriceInPoints","changePriceInPercents"]))),128))}}),Z={class:"container"},Q=w({__name:"HomeView",setup(P){return(r,o)=>(m(),f("div",Z,[F(Y)]))}});export{Q as default};
