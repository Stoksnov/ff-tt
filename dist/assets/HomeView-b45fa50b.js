import{d as b,t as y,r as u,w as C,c as w,o as T,a as f,b as I,e as c,f as _,u as P,n as U,g as B,h as L,i as G,F as O,j as R,k as F}from"./index-68d0b82c.js";const M={class:"ticker-card"},A={class:"ticker-card__col"},D={class:"ticker-card__row"},H={class:"ticker-card__logo"},K={class:"ticker-card__ticker"},V={class:"ticker-card__row"},W={class:"ticker-card__name"},j={class:"ticker-card__col ticker-card__col_items-right"},$={class:"ticker-card__row"},q={key:0},J={class:"ticker-card__row"},X=b({__name:"TickerCard",props:{logo:{},ticker:{},price:{},companyName:{},changePriceInPoints:{},changePriceInPercents:{},minPriceStep:{}},setup(k){const a=k,{logo:p,ticker:s,price:v,companyName:g,changePriceInPoints:o,changePriceInPercents:l,minPriceStep:d}=y(a),i=u({badge:"",text:""}),t=u([]);C(()=>a.price,(n,h)=>{m(n>h),e(n,h)});const r=n=>(isNaN(n)&&(n=0),(Math.round(n*100)/100).toFixed(2)),e=(n,h)=>{let N=r(n),x=null;for(let S=0;S<N.length;S++)if(N[S]!==h.toString()[S]){x=S;break}t.value=[N.slice(0,x),N.slice(x)]},m=n=>{i.value={badge:n?"ticker-card__ltp_green":"ticker-card__ltp_red",text:""},setTimeout(()=>{i.value={badge:"",text:n?"text-green":"text-red"}},2e3)},E=w(()=>o.value===0?"":o.value>0?"text-green":"text-red");return T(()=>{t.value[1]=r(v.value)}),(n,h)=>(f(),I("div",M,[c("div",A,[c("div",D,[c("div",H,_(P(p)),1),c("div",K,_(P(s))+"|"+_(P(d)),1)]),c("div",V,[c("div",W,_(P(g)),1)])]),c("div",j,[c("div",$,[c("div",{class:U(["ticker-card__ltp",i.value.badge])},[t.value[0]?(f(),I("span",q,_(t.value[0]),1)):B("",!0),c("span",{class:U(i.value.text)},_(t.value[1]),3)],2)]),c("div",J,[c("div",{class:U(["ticker-card__changes",E.value])},_(r(P(o))),3),c("div",{class:U(["ticker-card__changes",E.value])},_(r(P(l)))+"% ",3)])])]))}});function Y(k,a){const p="WebSocket"in window;let s=null;const v=u(null),g=u(null),o=u(null),l=u(!1),d=u(!1),i=u(!1);let t=()=>{},r=()=>{};return p&&(s=new WebSocket(k,a),s.addEventListener("message",e=>{v.value=e,o.value=e.data}),s.addEventListener("error",e=>{g.value=e,i.value=!0}),s.addEventListener("close",()=>{l.value=!1,d.value=!0}),s.addEventListener("open",()=>{l.value=!0,d.value=!1}),t=e=>s.send(e),r=(e,m)=>{s.close(e,m)}),{supported:p,ws:s,send:t,close:r,messageEvent:v,errorEvent:g,data:o,isOpen:l,isClosed:d,errored:i}}const Z=b({__name:"TickerCardList",setup(k){const a=L({}),p=w(()=>Object.values(a)),s=["RSTI","GAZP","MRKZ","RUAL","HYDR","MRKS","SBER","FEES","TGKA","VTBR","ANH.US","VICL.US","BURG.US","NBL.US","YETI.US","WSFS.US","NIO.US","DXC.US","MIC.US","HSBC.US","EXPN.EU","GSK.EU","SHP.EU","MAN.EU","DB1.EU","MUV2.EU","TATE.EU","KGF.EU","MGGT.EU","SGGD.EU"],{isOpen:v,send:g,messageEvent:o}=Y("wss://wss.tradernet.ru");C(()=>v.value,t=>{t&&g(JSON.stringify(["quotes",s]))});const l={ticker:"c",price:"ltp",companyName:"name",changePriceInPoints:"chg",changePriceInPercents:"pcp",minPriceStep:"min_step"},d=Object.values(l),i=Object.keys(l);return C(()=>o.value,t=>{const r=JSON.parse(t.data);if(r[0]!=="q")return;const e=r[1];for(const m in e){const E=d.indexOf(m);d.includes(m)&&(a[e.c]||(a[e.c]={}),a[e.c][i[E]]=e[m])}}),(t,r)=>(f(!0),I(O,null,G(p.value,e=>(f(),R(X,{key:e.ticker,ticker:e.ticker,price:e.price,companyName:e.companyName,changePriceInPoints:e.changePriceInPoints,changePriceInPercents:e.changePriceInPercents,minPriceStep:e.minPriceStep},null,8,["ticker","price","companyName","changePriceInPoints","changePriceInPercents","minPriceStep"]))),128))}}),z={class:"container"},ee=b({__name:"HomeView",setup(k){return(a,p)=>(f(),I("div",z,[F(Z)]))}});export{ee as default};
